<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é‡çƒÃ—ã‚³ãƒ¼ãƒ’ãƒ¼ ã‚¬ãƒãƒ£æŠ½é¸</title>
<style>
body{
  margin:0;
  font-family:sans-serif;
  background:linear-gradient(120deg,#f5f0e1,#c7a17a);
  display:flex;
  flex-direction:column;
  align-items:center;
  min-height:100vh;
  padding:16px;
}

/* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
section{margin-bottom:16px;width:100%;max-width:360px;}
label{display:block;margin-bottom:4px;font-weight:bold;}
input,textarea,button{width:100%;margin-bottom:6px;padding:8px;border-radius:8px;border:1px solid #ccc;box-sizing:border-box;}
button{background:#8b5e3c;color:#fff;font-weight:bold;border:none;cursor:pointer;}

/* æŠ½é¸è¡¨ */
#prizeTable{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(80px,1fr));
  gap:8px;
  margin-bottom:16px;
}
.prizeCard{
  width:80px;
  height:80px;
  background:#fff0e5;
  border-radius:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-size:12px;
  box-shadow:0 4px 8px rgba(0,0,0,0.3);
  overflow:hidden;
  border:2px solid #8b5e3c;
}
.prizeCard img{width:100%;height:50px;object-fit:cover;border-radius:6px;}

/* ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰ */
#memberStage{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(80px,1fr));
  gap:8px;
  margin-bottom:16px;
}
.memberCard{
  width:80px;
  text-align:center;
  cursor:pointer;
  background:#fff4e0;
  border-radius:12px;
  border:2px solid #d2691e;
  box-shadow:0 3px 6px rgba(0,0,0,0.2);
}
.memberCard img{
  width:80px;
  height:80px;
  border-radius:50%;
  object-fit:cover;
  border:2px solid #fff;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
}

/* ã‚¬ãƒãƒ£ãƒœãƒƒã‚¯ã‚¹ */
#gachaBox{
  position:relative;
  width:200px;
  height:220px;
  border-radius:16px;
  background:rgba(255,255,255,0.2);
  backdrop-filter:blur(8px);
  border:3px solid rgba(139,94,60,0.7);
  margin-bottom:16px;
  overflow:hidden;
}
.ball{
  position:absolute;
  width:60px;
  height:60px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 4px 8px rgba(0,0,0,0.3);
  overflow:hidden;
  transition:transform 1s ease, top 1s ease, left 1s ease;
}
.ball img{
  width:100%;
  height:100%;
  object-fit:cover;
  border-radius:50%;
}
.ball.spin{
  animation:spin 1.5s linear infinite;
}
@keyframes spin{
  0%{transform: rotate(0deg);}
  100%{transform: rotate(360deg);}
}
.ball.open{
  animation:openBall 0.6s forwards;
}
@keyframes openBall{
  0% {transform: scale(1);}
  50% {transform: scale(1.3) rotate(15deg);}
  100% {transform: scale(1) rotate(0deg);}
}

/* å½“ãŸã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
#message{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%) scale(0);
  font-size:20px;
  font-weight:bold;
  color:#fff;
  text-align:center;
  pointer-events:none;
  z-index:20;
}
#message.show{
  transform:translate(-50%,-50%) scale(1);
  transition:transform 0.6s ease;
}
#message img{
  width:100px;
  height:100px;
  object-fit:cover;
  border-radius:12px;
  margin:6px;
  box-shadow:0 4px 12px rgba(0,0,0,0.4);
}
#messageContent{
  display:flex;
  flex-direction:column;
  align-items:center;
}
</style>
</head>
<body>

<section>
  <label>ã‚³ãƒ¼ãƒ’ãƒ¼è³å“ç™»éŒ²ï¼ˆå†™çœŸï¼‹åå‰ï¼‰</label>
  <input type="file" id="prizeImg" accept="image/*">
  <input type="text" id="prizeName" placeholder="è³å“å">
  <button id="addPrize">è¿½åŠ </button>
</section>

<div id="prizeTable"></div>

<section>
  <label>é‡çƒãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ï¼ˆå†™çœŸï¼‹åå‰ï¼‰</label>
  <input type="file" id="memberImg" accept="image/*">
  <input type="text" id="memberName" placeholder="åå‰">
  <button id="addMember">è¿½åŠ </button>
</section>

<div id="memberStage"></div>

<div id="gachaBox"></div>
<button id="startGacha">ã‚¬ãƒãƒ£ã‚’å¼•ã</button>

<div id="message">
  <div id="messageContent"></div>
</div>

<script>
const prizeTable=document.getElementById('prizeTable');
const memberStage=document.getElementById('memberStage');
const gachaBox=document.getElementById('gachaBox');
const startGacha=document.getElementById('startGacha');
const message=document.getElementById('message');
const messageContent=document.getElementById('messageContent');

let prizes=[];
let members=[];
let balls=[];

// è³å“è¿½åŠ 
document.getElementById('addPrize').addEventListener('click',()=>{
  const file=document.getElementById('prizeImg').files[0];
  const name=document.getElementById('prizeName').value.trim();
  if(!file||!name){ alert('å†™çœŸã¨åå‰ã‚’å…¥åŠ›'); return; }
  const reader=new FileReader();
  reader.onload=e=>{
    const src=e.target.result;
    prizes.push({name,src});
    renderPrizes();
    createGachaBalls();
  };
  reader.readAsDataURL(file);
});

// ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ 
document.getElementById('addMember').addEventListener('click',()=>{
  const file=document.getElementById('memberImg').files[0];
  const name=document.getElementById('memberName').value.trim();
  if(!file||!name){ alert('å†™çœŸã¨åå‰ã‚’å…¥åŠ›'); return; }
  const reader=new FileReader();
  reader.onload=e=>{
    const src=e.target.result;
    members.push({name,src});
    renderMembers();
  };
  reader.readAsDataURL(file);
});

// è¡¨ç¤º
function renderPrizes(){
  prizeTable.innerHTML='';
  prizes.forEach(p=>{
    const div=document.createElement('div');
    div.className='prizeCard';
    div.innerHTML=`<img src="${p.src}"><div>${p.name}</div>`;
    prizeTable.appendChild(div);
  });
}

function renderMembers(){
  memberStage.innerHTML='';
  members.forEach((m,i)=>{
    const div=document.createElement('div');
    div.className='memberCard';
    div.innerHTML=`<img src="${m.src}"><div>${m.name}</div>`;
    memberStage.appendChild(div);
  });
}

// ã‚¬ãƒãƒ£ãƒœãƒ¼ãƒ«ä½œæˆï¼ˆç”»åƒå…¥ã‚Šï¼‰
function createGachaBalls(){
  gachaBox.innerHTML='';
  balls=[];
  prizes.forEach((p,i)=>{
    const ball=document.createElement('div');
    ball.className='ball spin';
    const img=document.createElement('img');
    img.src=p.src;
    ball.appendChild(img);
    const top=Math.random()*120+40;
    const left=Math.random()*60+60;
    ball.style.top=top+'px';
    ball.style.left=left+'px';
    gachaBox.appendChild(ball);
    balls.push({ball,p});
  });
}

// ã‚¬ãƒãƒ£å®Ÿè¡Œ
startGacha.addEventListener('click',()=>{
  if(members.length===0||balls.length===0){ alert('ãƒ¡ãƒ³ãƒãƒ¼ã¨è³å“ã‚’ç™»éŒ²'); return; }
  const memberIdx=Math.floor(Math.random()*members.length);
  const member=members[memberIdx];

  const ballIdx=Math.floor(Math.random()*balls.length);
  const {ball,p}=balls[ballIdx];
  balls.splice(ballIdx,1);

  // ä¸Šã«ç§»å‹•
  const offsetY=-120;
  ball.style.transition='transform 1s ease, top 1s ease, left 1s ease';
  ball.style.top=parseFloat(ball.style.top)+offsetY+'px';

  setTimeout(()=>{
    ball.classList.remove('spin');
    ball.classList.add('open');
  },1000);

  setTimeout(()=>{
    // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    messageContent.innerHTML='';
    const memberImg=document.createElement('img');
    memberImg.src=member.src;
    const prizeImg=document.createElement('img');
    prizeImg.src=p.src;
    const text=document.createElement('div');
    text.textContent=`${member.name} ã•ã‚“ã®å½“ãŸã‚Šã¯: ${p.name} ğŸ‰`;
    messageContent.appendChild(memberImg);
    messageContent.appendChild(prizeImg);
    messageContent.appendChild(text);
    message.classList.add('show');
    setTimeout(()=>message.classList.remove('show'),2500);
  },1600);
});
</script>
</body>
</html>
